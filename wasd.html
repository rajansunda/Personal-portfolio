<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rajan Sunda - Interactive Portfolio</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      html,
      body {
        width: 100%;
        height: 100vh;
        overflow: hidden;
        background: #0a0a0a;
      }

      #gameCanvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
      }

      /* UI Overlay */
      .ui-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
        color: white;
      }

      /* Header */
      .header {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        pointer-events: auto;
        background: rgba(30, 40, 80, 0.8);
        padding: 15px 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(76, 201, 240, 0.3);
      }

      .header h1 {
        font-size: 2rem;
        background: linear-gradient(45deg, #4cc9f0, #4361ee);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 5px;
      }

      .header p {
        color: #e0e0e0;
        font-size: 0.9rem;
      }

      /* Controls */
      .controls {
        position: absolute;
        bottom: 30px;
        right: 30px;
        background: rgba(30, 40, 80, 0.8);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(76, 201, 240, 0.3);
        pointer-events: auto;
      }

      .controls h3 {
        color: #4cc9f0;
        margin-bottom: 15px;
        text-align: center;
      }

      .keys {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-bottom: 15px;
      }

      .key {
        width: 45px;
        height: 45px;
        background: rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 8px;
        font-weight: bold;
        border: 2px solid rgba(76, 201, 240, 0.3);
        transition: all 0.2s;
      }

      .key.active {
        background: rgba(76, 201, 240, 0.5);
        border-color: #4cc9f0;
        transform: scale(0.95);
      }

      .key.w {
        grid-column: 2;
      }
      .key.a {
        grid-column: 1;
        grid-row: 2;
      }
      .key.s {
        grid-column: 2;
        grid-row: 2;
      }
      .key.d {
        grid-column: 3;
        grid-row: 2;
      }

      .instruction {
        text-align: center;
        color: #e0e0e0;
        font-size: 0.8rem;
        margin-top: 10px;
      }

      /* Section Info Panel */
      .section-info {
        position: absolute;
        top: 40%;
        left: 30px;
        transform: translateY(-50%);
        background: rgba(30, 40, 80, 0.9);
        padding: 25px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(76, 201, 240, 0.3);
        max-width: 400px;
        pointer-events: auto;
        opacity: 1;
        transition: all 0.3s ease;
      }

      .section-info.active {
        opacity: 1;
        transform: translateY(-50%) translateX(0);
      }

      .section-info h2 {
        color: #4cc9f0;
        margin-bottom: 15px;
        font-size: 1.5rem;
      }

      .section-info p {
        color: #e0e0e0;
        line-height: 1.6;
        margin-bottom: 15px;
      }

      .section-info ul {
        color: #e0e0e0;
        padding-left: 20px;
        margin-bottom: 15px;
      }

      .section-info li {
        margin-bottom: 8px;
      }

      .btn {
        display: inline-block;
        background: linear-gradient(45deg, #4361ee, #4cc9f0);
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: transform 0.3s;
        margin: 5px;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      /* Zone Labels - Enhanced */
      .zone-label {
        position: absolute;
        background: rgba(76, 201, 240, 0.9);
        color: white;
        padding: 10px 18px;
        border-radius: 25px;
        font-weight: bold;
        font-size: 1rem;
        pointer-events: none;
        transform: translateX(-50%);
        animation: float 3s ease-in-out infinite;
        box-shadow: 0 4px 15px rgba(76, 201, 240, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
        z-index: 15;
        transition: all 0.3s ease;
      }

      .zone-label.nearby {
        background: rgba(76, 201, 240, 1);
        transform: translateX(-50%) scale(1.1);
        animation: pulse 1s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateX(-50%) translateY(0);
        }
        50% {
          transform: translateX(-50%) translateY(-12px);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 4px 15px rgba(76, 201, 240, 0.3);
        }
        50% {
          box-shadow: 0 6px 25px rgba(76, 201, 240, 0.6);
        }
      }

      /* Mini-map */
      .minimap {
        position: absolute;
        bottom: 30px;
        left: 30px;
        width: 200px;
        height: 200px;
        background: rgba(30, 40, 80, 0.8);
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(76, 201, 240, 0.3);
        pointer-events: auto;
        overflow: hidden;
      }

      .minimap-title {
        color: #4cc9f0;
        text-align: center;
        padding: 10px;
        font-size: 0.9rem;
        font-weight: bold;
        border-bottom: 1px solid rgba(76, 201, 240, 0.3);
      }

      .minimap-content {
        position: relative;
        width: 100%;
        height: calc(100% - 40px);
        overflow: hidden;
      }

      .minimap-zone {
        position: absolute;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid white;
        transform: translate(-50%, -50%);
      }

      .minimap-player {
        position: absolute;
        width: 8px;
        height: 8px;
        background: #4cc9f0;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 10px #4cc9f0;
      }

      /* Progress indicator */
      .progress-indicator {
        position: absolute;
        top: 120px;
        right: 30px;
        background: rgba(30, 40, 80, 0.8);
        padding: 15px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(76, 201, 240, 0.3);
        pointer-events: auto;
        min-width: 180px;
      }

      .progress-title {
        color: #4cc9f0;
        font-size: 0.9rem;
        font-weight: bold;
        margin-bottom: 10px;
        text-align: center;
      }

      .progress-list {
        list-style: none;
        padding: 0;
      }

      .progress-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 0.8rem;
        color: #e0e0e0;
      }

      .progress-item.visited {
        color: #4cc9f0;
      }

      .progress-item .icon {
        width: 16px;
        height: 16px;
        margin-right: 8px;
        border-radius: 50%;
        border: 2px solid #666;
      }

      .progress-item.visited .icon {
        background: #4cc9f0;
        border-color: #4cc9f0;
      }

      /* Distance indicator */
      .distance-indicator {
        position: absolute;
        bottom: 50%;
        left: 50%;
        transform: translate(-50%, 50%);
        background: rgba(30, 40, 80, 0.9);
        padding: 10px 20px;
        border-radius: 20px;
        color: #4cc9f0;
        font-size: 0.9rem;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
      }

      .distance-indicator.visible {
        opacity: 1;
      }

      /* Enhanced Loading Screen */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at center, #1a2a6c, #0d1b3a);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 100;
        transition: opacity 0.5s ease;
        overflow: hidden;
      }

      .spinner {
        width: 70px;
        height: 70px;
        border: 6px solid rgba(76, 201, 240, 0.2);
        border-radius: 50%;
        border-top-color: #4cc9f0;
        animation: spin 1.2s linear infinite;
        margin-bottom: 25px;
        box-shadow: 0 0 15px #4cc9f0;
        position: relative;
      }

      .spinner::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        background: #4cc9f0;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 10px #4cc9f0;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: #e0e0e0;
        font-size: 1.3rem;
        text-align: center;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        text-shadow: 0 0 8px #4cc9f0;
        user-select: none;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .header {
          top: 10px;
          padding: 10px 20px;
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .controls {
          bottom: 20px;
          right: 20px;
          padding: 15px;
        }

        .key {
          width: 40px;
          height: 40px;
        }

        .section-info {
          left: 20px;
          right: 20px;
          max-width: none;
        }

        .minimap {
          width: 150px;
          height: 150px;
        }

        .progress-indicator {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <a href="index.html" class="back-button">‚Üê Back to Portfolio</a>

    <style>
      .back-button {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 20;
        background: rgba(76, 201, 240, 0.8);
        color: #000;
        padding: 10px 20px;
        border-radius: 30px;
        text-decoration: none;
        font-weight: 500;
        transition: 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .back-button:hover {
        background: #3b82f6;
        color: #fff;
      }
    </style>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
      <div class="spinner"></div>
      <div class="loading-text">
        <p>Loading Interactive Portfolio...</p>
        <p style="font-size: 0.9rem; margin-top: 10px">Get ready to explore!</p>
      </div>
    </div>

    <!-- 3D Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- UI Overlay -->
    <div class="ui-overlay">
      <!-- Header -->
      <div class="header">
        <h1>Rajan Sunda</h1>
        <p>Interactive Software Developer Portfolio</p>
      </div>

      <!-- Controls -->
      <div class="controls">
        <h3>Move Around</h3>
        <div class="keys">
          <div class="key w">W</div>
          <div class="key a">A</div>
          <div class="key s">S</div>
          <div class="key d">D</div>
        </div>
        <div class="instruction">
          Walk to different zones to explore my work!
        </div>
      </div>

      <!-- Mini-map -->
      <div class="minimap">
        <div class="minimap-title">Portfolio Map</div>
        <div class="minimap-content" id="minimapContent">
          <div class="minimap-player" id="minimapPlayer"></div>
        </div>
      </div>

      <!-- Progress Indicator -->
      <div class="progress-indicator">
        <div class="progress-title">Exploration Progress</div>
        <ul class="progress-list" id="progressList">
          <li class="progress-item" id="progress-about">
            <div class="icon"></div>
            <span>About Me</span>
          </li>
          <li class="progress-item" id="progress-services">
            <div class="icon"></div>
            <span>Services</span>
          </li>
          <li class="progress-item" id="progress-projects">
            <div class="icon"></div>
            <span>Projects</span>
          </li>
          <li class="progress-item" id="progress-skills">
            <div class="icon"></div>
            <span>Skills</span>
          </li>
          <li class="progress-item" id="progress-contact">
            <div class="icon"></div>
            <span>Contact</span>
          </li>
        </ul>
      </div>

      <!-- Distance Indicator -->
      <div class="distance-indicator" id="distanceIndicator">
        Distance to nearest zone: <span id="distanceValue">0</span>m
      </div>

      <!-- Section Info Panel -->
      <div class="section-info active" id="sectionInfo">
        <h2 id="sectionTitle">Welcome!</h2>
        <div id="sectionContent">
          <p>
            Move around the 3D space to explore different sections of my
            portfolio. Each zone contains information about my skills, projects,
            and experience.
          </p>
          <p>Use WASD keys to move your character around!</p>
          <p>You can also zoom in and out using the mouse scroll wheel.</p>
        </div>
      </div>

      <!-- Zone Labels -->
      <div class="zone-label" id="aboutLabel">
        <i class="fas fa-user"></i> About Me
      </div>
      <div class="zone-label" id="servicesLabel">
        <i class="fas fa-cogs"></i> Services
      </div>
      <div class="zone-label" id="projectsLabel">
        <i class="fas fa-code"></i> Projects
      </div>
      <div class="zone-label" id="skillsLabel">
        <i class="fas fa-laptop-code"></i> Skills
      </div>
      <div class="zone-label" id="contactLabel">
        <i class="fas fa-envelope"></i> Contact
      </div>
    </div>

    <!-- Three.js Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
      // Global variables
      let scene, camera, renderer, character, controls;
      let currentZone = "welcome";
      const zones = {};
      const keys = {};
      const visitedZones = new Set();

      let mixer;
      const clock = new THREE.Clock();

      // Renderer setup
      renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById("gameCanvas"),
        antialias: true,
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;

      // Initialize the 3D scene
      function init() {
        // Scene setup
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a0a);
        scene.fog = new THREE.Fog(0x0a0a0a, 50, 200);

        // Camera setup
        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(0, 24, 40);

        // OrbitControls setup
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 1, 0); // Focus point ‚Äî adjust if needed
        controls.enableDamping = true;
        controls.dampingFactor = 0.1;
        controls.enablePan = false;
        controls.minDistance = 5;
        controls.maxDistance = 50;
        controls.maxPolarAngle = Math.PI / 2; // Prevent going under the floor

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(10, 20, 10);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        scene.add(directionalLight);

        // Create floor
        createFloor();

        // Create character
        createCharacter();

        // Create zones
        createZones();

        // Set up event listeners
        setupEventListeners();

        // Initialize UI
        initializeUI();

        // Start animation loop
        animate();

        // Hide loading screen
        setTimeout(() => {
          document.getElementById("loadingScreen").style.opacity = "0";
          setTimeout(() => {
            document.getElementById("loadingScreen").style.display = "none";
          }, 500);
        }, 2000);
      }

      function createFloor() {
        const floorGeometry = new THREE.PlaneGeometry(200, 200);
        const floorMaterial = new THREE.MeshStandardMaterial({
          color: 0x1a1a1a,
          roughness: 0.8,
          metalness: 0.2,
        });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);

        // Add grid
        const gridHelper = new THREE.GridHelper(200, 40, 0x333333, 0x222222);
        scene.add(gridHelper);
      }

      function createCharacter() {
        const loader = new THREE.GLTFLoader();
        loader.load(
          "assets/character.glb", // path to your model
          function (gltf) {
            character = gltf.scene;
            character.scale.set(2, 2, 2); // scale up the character
            character.position.set(0, 0, 0);
            scene.add(character);

            // Create animation mixer for the character
            mixer = new THREE.AnimationMixer(character);

            // Play the first animation clip (usually walking or idle)
            if (gltf.animations.length > 0) {
              const action = mixer.clipAction(gltf.animations[0]);
              action.play();
            }
          },
          undefined,
          function (error) {
            console.error("An error happened loading the character:", error);
          }
        );
      }

      function createZones() {
        // Define zone positions and data
        const zoneData = {
          about: {
            position: { x: -15, z: -10 },
            color: 0x4cc9f0,
            title: "About Me",
            content: `
                              <p>Computer Science graduate from Kingston University with a passion for building user-friendly digital solutions.</p>
                              <p>I combine technical skills with creativity to deliver reliable, effective software that makes a difference.</p>
                              <ul>
                                  <li>üéì BSc Computer Science - Kingston University</li>
                                  <li>üíº 3+ years professional experience</li>
                                  <li>üöÄ Specialized in mobile & web development</li>
                              </ul>
                          `,
          },
          services: {
            position: { x: 15, z: -10 },
            color: 0x4361ee,
            title: "My Services",
            content: `
                              <p>I offer comprehensive software development services:</p>
                              <ul>
                                  <li>üì± Mobile App Development (React Native, Kotlin)</li>
                                  <li>üåê Web Development (JavaScript, Node.js)</li>
                                  <li>üóÑÔ∏è Database Solutions (SQL, MongoDB)</li>
                                  <li>üé® UI/UX Design & Implementation</li>
                              </ul>
                              <a href="mailto:rajansunda@yahoo.co.uk" class="btn">Get Quote</a>
                          `,
          },
          projects: {
            position: { x: -15, z: 15 },
            color: 0x7209b7,
            title: "Featured Projects",
            content: `
                              <p>Here are some of my recent projects:</p>
                              <ul>
                                  <li>üè• MyKneeRecovery App - React Native health app</li>
                                  <li>üõ°Ô∏è Stay Safe App - Location sharing platform</li>
                                  <li>üìö Book Manager - Kotlin Android application</li>
                                  <li>üåê Portfolio Website - Interactive 3D experience</li>
                              </ul>
                              <a href="https://github.com/rajansunda" class="btn" target="_blank">View GitHub</a>
                          `,
          },
          skills: {
            position: { x: 15, z: 15 },
            color: 0xf72585,
            title: "Technical Skills",
            content: `
                              <p>My technical expertise includes:</p>
                              <ul>
                                  <li>üíª Languages: JavaScript, Kotlin, C#, SQL</li>
                                  <li>üîß Frameworks: React Native, Node.js, ASP.NET</li>
                                  <li>üé® Frontend: HTML5, CSS3, React</li>
                                  <li>üóÑÔ∏è Databases: SQL Server, SQLite, MongoDB</li>
                                  <li>üõ†Ô∏è Tools: Android Studio, Visual Studio, Git</li>
                              </ul>
                          `,
          },
          contact: {
            position: { x: 0, z: 25 },
            color: 0x06ffa5,
            title: "Get In Touch",
            content: `
                              <p>Ready to work together? Let's discuss your project!</p>
                              <ul>
                                  <li>üìß rajansunda@yahoo.co.uk</li>
                                  <li>üì± 07388864418</li>
                                  <li>üìç London</li>
                              </ul>
                              <a href="mailto:rajansunda@yahoo.co.uk" class="btn">Send Email</a>
                              <a href="https://github.com/rajansunda" class="btn" target="_blank">GitHub</a>
                          `,
          },
        };

        // Create zone markers
        Object.entries(zoneData).forEach(([key, data]) => {
          // Create zone marker
          const zoneGeometry = new THREE.CylinderGeometry(3, 3, 0.2, 8);
          const zoneMaterial = new THREE.MeshStandardMaterial({
            color: data.color,
            emissive: data.color,
            emissiveIntensity: 0.2,
            transparent: true,
            opacity: 0.7,
          });
          const zone = new THREE.Mesh(zoneGeometry, zoneMaterial);
          zone.position.set(data.position.x, 0.1, data.position.z);
          scene.add(zone);

          // Create floating icon
          const iconGeometry = new THREE.SphereGeometry(0.5, 8, 8);
          const iconMaterial = new THREE.MeshStandardMaterial({
            color: data.color,
            emissive: data.color,
            emissiveIntensity: 0.3,
          });
          const icon = new THREE.Mesh(iconGeometry, iconMaterial);
          icon.position.set(data.position.x, 3, data.position.z);
          scene.add(icon);

          zones[key] = {
            ...data,
            marker: zone,
            icon: icon,
          };
        });
      }

      function initializeUI() {
        // Position zone labels
        updateZoneLabels();

        // Initialize minimap
        initializeMinimap();

        // Show initial section info
        updateSectionInfo({
          title: "Welcome!",
          content: `
                          <p>Move around the 3D space to explore different sections of my portfolio. Each glowing zone contains information about my skills, projects, and experience.</p>
                          <p>Use WASD keys to move your character around!</p>
                          <p>You can also zoom in and out using the mouse scroll wheel!</p>
                      `,
        });
      }

      function initializeMinimap() {
        const minimapContent = document.getElementById("minimapContent");

        // Add zone dots to minimap
        Object.entries(zones).forEach(([key, zone]) => {
          const dot = document.createElement("div");
          dot.className = "minimap-zone";
          dot.style.backgroundColor = `#${zone.color
            .toString(16)
            .padStart(6, "0")}`;

          // Convert 3D position to minimap position
          const mapX = ((zone.position.x + 40) / 80) * 180 + 10;
          const mapZ = ((zone.position.z + 40) / 80) * 140 + 10;

          dot.style.left = mapX + "px";
          dot.style.top = mapZ + "px";

          minimapContent.appendChild(dot);
        });
      }

      function updateZoneLabels() {
        Object.entries(zones).forEach(([key, zone]) => {
          const label = document.getElementById(`${key}Label`);
          if (label) {
            // Convert 3D position to screen position
            const vector = new THREE.Vector3(
              zone.position.x,
              4,
              zone.position.z
            );
            vector.project(camera);

            const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
            const y = (vector.y * -0.5 + 0.5) * window.innerHeight;

            label.style.left = x + "px";
            label.style.top = y + "px";
          }
        });
      }

      function updateMinimap() {
        const minimapPlayer = document.getElementById("minimapPlayer");
        if (minimapPlayer && character) {
          // Convert character position to minimap position
          const mapX = ((character.position.x + 40) / 80) * 180 + 10;
          const mapZ = ((character.position.z + 40) / 80) * 140 + 10;

          minimapPlayer.style.left = mapX + "px";
          minimapPlayer.style.top = mapZ + "px";
        }
      }

      function setupEventListeners() {
        // Keyboard controls
        window.addEventListener("keydown", (e) => {
          keys[e.key.toLowerCase()] = true;
          updateKeyUI(e.key.toLowerCase(), true);
        });

        window.addEventListener("keyup", (e) => {
          keys[e.key.toLowerCase()] = false;
          updateKeyUI(e.key.toLowerCase(), false);
        });

        // Window resize
        window.addEventListener("resize", () => {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        });
      }

      function updateKeyUI(key, isActive) {
        const keyElement = document.querySelector(`.key.${key}`);
        if (keyElement) {
          keyElement.classList.toggle("active", isActive);
        }
      }

      function updateCharacterMovement() {
        if (!character) return false;

        const speed = 0.15;
        let moved = false;

        if (keys["w"]) {
          character.position.z -= speed;
          moved = true;
        }
        if (keys["s"]) {
          character.position.z += speed;
          moved = true;
        }
        if (keys["a"]) {
          character.position.x -= speed;
          moved = true;
        }
        if (keys["d"]) {
          character.position.x += speed;
          moved = true;
        }

        // Keep character within bounds
        character.position.x = Math.max(
          -40,
          Math.min(40, character.position.x)
        );
        character.position.z = Math.max(
          -40,
          Math.min(40, character.position.z)
        );

        // Update camera to follow character
        //camera.position.x = character.position.x;
        //camera.position.z = character.position.z + 12;
        //camera.lookAt(
        //character.position.x,
        //character.position.y,
        //character.position.z
        //);

        return moved;
      }

      function checkZoneProximity() {
        if (!character) return;

        const characterPos = character.position;
        let nearestZone = null;
        let minDistance = Infinity;

        Object.entries(zones).forEach(([key, zone]) => {
          if (!zone.position) return; // Prevents crash if zone.position is undefined

          const distance = Math.sqrt(
            Math.pow(characterPos.x - zone.position.x, 2) +
              Math.pow(characterPos.z - zone.position.z, 2)
          );

          if (distance < 5 && distance < minDistance) {
            minDistance = distance;
            nearestZone = key;
          }

          // Update zone label highlighting
          const label = document.getElementById(`${key}Label`);
          if (label) {
            if (distance < 8) {
              label.classList.add("nearby");
            } else {
              label.classList.remove("nearby");
            }
          }
        });

        // Update distance indicator
        updateDistanceIndicator(minDistance);

        if (nearestZone && nearestZone !== currentZone) {
          currentZone = nearestZone;
          visitedZones.add(nearestZone);
          updateSectionInfo(zones[nearestZone]);
          updateProgressIndicator();
        } else if (!nearestZone && currentZone !== "welcome") {
          currentZone = "welcome";
          updateSectionInfo({
            title: "Welcome!",
            content: `
        <p>Move around the 3D space to explore different sections of my portfolio. Each glowing zone contains information about my skills, projects, and experience.</p>
        <p>Use WASD keys to move your character around!</p>
        <p>You can also zoom in and out using the mouse scroll wheel.</p>
      `,
          });
        }
      }

      function updateDistanceIndicator(distance) {
        const distanceIndicator = document.getElementById("distanceIndicator");
        const distanceValue = document.getElementById("distanceValue");

        if (distance < Infinity && distance > 5) {
          distanceIndicator.classList.add("visible");
          distanceValue.textContent = Math.round(distance);
        } else {
          distanceIndicator.classList.remove("visible");
        }
      }

      function updateProgressIndicator() {
        visitedZones.forEach((zone) => {
          const progressItem = document.getElementById(`progress-${zone}`);
          if (progressItem) {
            progressItem.classList.add("visited");
          }
        });
      }

      function updateSectionInfo(zoneData) {
        const sectionInfo = document.getElementById("sectionInfo");
        const sectionTitle = document.getElementById("sectionTitle");
        const sectionContent = document.getElementById("sectionContent");

        sectionTitle.textContent = zoneData.title;
        sectionContent.innerHTML = zoneData.content;
        sectionInfo.classList.add("active");
      }

      function animate() {
        requestAnimationFrame(animate);

        // Prevent rendering if scene or camera is not ready
        if (!scene || !camera || !renderer) return;

        const delta = clock.getDelta();
        if (mixer) mixer.update(delta);

        // Update character movement
        const moved = updateCharacterMovement();

        // Update UI elements if character moved
        if (moved) {
          updateZoneLabels();
          updateMinimap();
        }

        // Check zone proximity
        checkZoneProximity();

        // Animate zone icons
        Object.values(zones).forEach((zone) => {
          if (zone.icon) {
            zone.icon.rotation.y += 0.02;
            zone.icon.position.y = 3 + Math.sin(Date.now() * 0.002) * 0.5;
          }
        });
        if (controls) controls.update();
        renderer.render(scene, camera);
      }

      // Start the application
      init();
    </script>
  </body>
</html>
